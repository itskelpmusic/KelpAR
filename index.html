<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KelpAR — Zappar WebAR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: #000;
    }
    #status {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      padding: 8px 12px;
      background: rgba(0,0,0,0.4);
      z-index: 10;
      font-size: 16px;
      font-family: sans-serif;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>

  <!-- CORRECT Zappar libraries -->
  <script src="https://libs.zappar.com/zappar/2.2.0/zappar.js"></script>
  <script src="https://libs.zappar.com/zappar-threejs/2.2.0/zappar-threejs.js"></script>

  <!-- THREE.js -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>

</head>

<body>
  <div id="status">Status: loading…</div>
  <canvas id="canvas"></canvas>

<script>
  const statusEl = document.getElementById("status");
  const setStatus = (msg) => statusEl.textContent = "Status: " + msg;

  // Zappar camera + renderer setup
  const renderer = new THREE.WebGLRenderer({
    canvas: document.getElementById("canvas"),
    alpha: true,
    antialias: true
  });

  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);

  const camera = new ZapparThree.Camera();
  const scene = new THREE.Scene();
  scene.add(camera);

  // Load your image target
  const tracker = new ZapparThree.ImageTrackerLoader().load("./assets/polygon.zpt");
  const anchor = new ZapparThree.ImageAnchorGroup(camera, tracker);
  scene.add(anchor);

  // Debug cube so we SEE tracking
  const cube = new THREE.Mesh(
    new THREE.BoxGeometry(0.2, 0.2, 0.2),
    new THREE.MeshNormalMaterial()
  );
  cube.visible = false;
  anchor.add(cube);

  tracker.onVisible.bind(() => {
    cube.visible = true;
    setStatus("target found");
  });

  tracker.onNotVisible.bind(() => {
    cube.visible = false;
    setStatus("target lost");
  });

  // Ask for camera permissions
  ZapparThree.permissionRequestUI().then((granted) => {
    if (granted) {
      ZapparThree.permissionGrantedUI();
      camera.start();
      animate();
    } else {
      ZapparThree.permissionDeniedUI();
    }
  });

  function animate() {
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }

  setStatus("ready — point at target");
</script>

</body>
</html>
